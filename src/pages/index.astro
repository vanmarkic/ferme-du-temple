---
import BaseLayout from '../layouts/BaseLayout.astro';
import { Providers } from '@/components/Providers';
import { Navigation } from '@/components/Navigation';
import type { NavigationContent } from '@/components/Navigation';
import { HeroSection } from '@/components/HeroSection';
import { ProjectSection } from '@/components/ProjectSection';
import { CollaborationSection } from '@/components/CollaborationSection';
import { LocationSection } from '@/components/LocationSection';
import { InscriptionForm } from '@/components/InscriptionForm';
import { TimelineSection } from '@/components/TimelineSection';
import { Footer } from '@/components/Footer';
import { getEntry, render } from 'astro:content';

// Load content from Content Collections
const navigationEntry = await getEntry('navigation', 'navigation');
const heroEntry = await getEntry('hero', 'hero');
const projectEntry = await getEntry('project', 'project');
const collaborationEntry = await getEntry('collaboration', 'collaboration');
const locationEntry = await getEntry('location', 'location');
const timelineEntry = await getEntry('timeline', 'timeline');
const inscriptionEntry = await getEntry('inscription', 'inscription');
const footerEntry = await getEntry('footer', 'footer');

// Error handling for missing entries
if (!navigationEntry) throw new Error('Navigation content not found');
if (!heroEntry) throw new Error('Hero content not found');
if (!projectEntry) throw new Error('Project content not found');
if (!collaborationEntry) throw new Error('Collaboration content not found');
if (!locationEntry) throw new Error('Location content not found');
if (!timelineEntry) throw new Error('Timeline content not found');
if (!inscriptionEntry) throw new Error('Inscription content not found');
if (!footerEntry) throw new Error('Footer content not found');

// Validate required properties
if (!projectEntry.data.title) throw new Error('Project title is required');
if (!projectEntry.data.subtitle) throw new Error('Project subtitle is required');

// Render markdown content to get body HTML
const { Content: ProjectContent } = await render(projectEntry);
const { Content: CollaborationContent } = await render(collaborationEntry);
const { Content: LocationContent } = await render(locationEntry);
const { Content: TimelineContent } = await render(timelineEntry);
const { Content: FooterContent } = await render(footerEntry);
---

<BaseLayout>
<Navigation client:visible content={navigationEntry.data as NavigationContent} />
<div class="min-h-screen pt-20">
<HeroSection client:idle content={heroEntry.data} />
<div id="projet">
<ProjectSection client:visible content={projectEntry.data} body={projectEntry.body} />
</div>
<div id="collaboration">
<CollaborationSection client:visible content={collaborationEntry.data} body={collaborationEntry.body} />
</div>
<div id="localisation">
<LocationSection client:visible content={locationEntry.data} body={locationEntry.body} />
</div>

<div id="timeline">
<TimelineSection client:visible content={timelineEntry.data} body={timelineEntry.body} />
</div>
<div id="inscription">
<Providers client:load>
<InscriptionForm client:visible content={inscriptionEntry.data} />
</Providers>
</div>
</div>

  <Footer slot="footer" content={footerEntry.data} body={footerEntry.body} />
</BaseLayout>
